---
layout: post
title: 자바 프로그래머에게 재귀는 왜 어려운가?
author: Bong5
categories: [Insight, Algorithms/Theory]
---

## Recursion

---
__재귀 코드를 보면 절대 흐름을 추적하려 하지 마십시오. 오히려 문제를 정의한 식으로 보십시오. 그리고 어떤 식으로 처리될 지 머리에서 CPU를 모의 실험하지 마시고 그 정의가 무엇을 나타내는 정의인지 이해하려고 하십시오.__

기초적인 재귀에 절망하다가 동기부여가 되는 포스트를 보고 옮겨본다.

첫 술에 배부를 수 없다. 재능이 뛰어나지 않지만 전혀 없는 것도 아니다.

지루한 연습, 의식적인 연습을 즐기자.

---



### 자바 프로그래머에게 재귀는 왜 어려운가?

저는 컴퓨터 과학 전공자가 아닙니다. 워낙 호기심이 많고 몰입하는 성향이라서 어릴 때 애호가로 프로그래밍을 시작했다가 전공을 버리고 프로그래머로 사회생활을 시작한 사람입니다.

그래서 체계적으로 이론 먼저 배우기 보다는 몸으로 먼저 익히고 나중에 이론을 배우며 정리하는 편입니다.

재귀 호출도 저에게는 그와 같은 사례 중 하나 입니다. 어릴 때 이런 저런 프로그래밍 관련 지식을 배우면서 알게 되었고 자연스럽게 익혀서 쓰는 기법입니다.

어떤 문제는 재귀가 아니면 쉽게 푸는 방법을 전혀 모르기도 합니다.

시간이 된다면 이 문제를 하나 풀어 보십시오.

미국에는 1센트, 5센트, 10센트, 25센트, 50센트 등 다섯가지 동전이 있습니다. 이 동전을 무한정 확보할 수 있다고 하면 이들의 조합으로 어떤 금액도 만들 수 있습니다.

특정 금액 m이 주어졌을 때 이 다섯가지 동전을 조합해서 주어진 금액을 만들 수 있는 경우의 수는 몇 가지가 있을까요?

꼭 완벽하게 풀지는 않더라도 몇 분만이라도 어떻게 푸렴ㄴ 될지 생각해 보십시오.

이 문제는 __컴퓨터 프로그램의 구조와 해석__ 이라는 책에서 __분기되는 재귀__ 를 설명하는 중에 예제로 나온 유명한 문제입니다. 저는 이 문제를 재귀가 아니면 잘 풀지 못합니다.

<script src="https://gist.github.com/BongHoLee/84f50cd2c91768b2ca8059e3338f27e4.js"></script>

어떤 분은 저와는 달리 (스택을 사용한다거나 하는 방법으로) 재귀를 사용하지 않고도 문제를 풀 수 있겠지만 이렇게 단순하게 해결되지는 않을 겁니다.

제가 말하고 싶은 건 재귀는 __어떤 문제의 경우 아주 효과적인 해결방법__ 입니다. 그리고 놀랍게도 __별로 어렵지도 않습니다.__

저는 최근에 자바 개발자 중에 재귀를 무척 어려운 고급 기법으로 알고 일부러 외면하거나 학습하면서 어려워 하는 모습을 보면서 사실 좀 놀랐습니다.

그리고 왜 그러는지 궁금했습니다. 절대 재귀를 어려워하는 분들을 조롱하고 비난한다는 얘기가 아닙니다. 저는 정말 프로그래밍에 숙달된 분 조차 재귀를 어렵게 느끼도록 하는 요인이 뭔지 궁금했습니다.

더 나아가서 그 문제를 풀어 줄 방법도 알고 싶었습니다. 아직 완벽하게 범인을 알아 낸 것은 아니지만 몇몇 용의자를 찾았고 그 중 누가 범인인지 대략 느낌이 갑니다.

#### 첫 째 용의자 : 높은 난이도.

가장 먼저 떠오르는 용의자는 __재귀가 정말 이해하기 어려운 기술이라는 주장__ 입니다. 재귀를 별다른 노력 없이 익힌 내가 초천재 일지도 모릅니다. IQ 140이 넘는 사람들은 세상 모든 사람들이 자기처럼 머리가 똑똑한 줄 안다고 하더군요.

저는 IQ가 겨우 100을 넘지만 혹시 IQ 테스트에 문제가 있던 것은 아닐까요? 알고 보면 제가 아인슈타인이나 파인만 같은 천재일지도 모릅니다.

하지만 이는 사실이 아닙니다. 단언컨데 저는 머리가 그리 좋지 않습니다.

학창 시절에도 성적이 좋지 않았고 사회 생활을 하면서도 늘 제 지능이 평균 수준이라는 사실은 끊임 없이 확인했습니다.

대체로 복잡한 일을 좋아하는 프로그래머 사이에서는 오히려 평균 이하라고 생각됩니다.

따라서 제가 재귀를 별 어려움 없이 습득했는데 저보다 ㄷ분명히 똑똑한 많은 사람들이 습득하는데 곤란을 겪은 이유는 대단히 복잡한 어려운 개념이기 때문이 아닙니다.

#### 둘 째 용의자 : 분기가 일어나는 반복적 구조 경험 부족

우리가 흔히 경험하는 반복적 구조는 __선형적 반복__ 입니다.

선형적 반복 상황에서도 재귀를 사용할 수 있고 실제로 __함수형 언어에서는 선형 반복에도 재귀를 사용__ 하지만 자바 프로그래머들은 보통 이런 반복 구조는 for, while 같은 반복문으로 처리합니다.

여러 반복문을 중복하는 2차원, 3차원 등 다차원 반복문도 결국은 __선형 반복의 변형__ 일 뿐입니다.

단순한 선형 반복이 아닌, 분기가 일어나는 반복적 상황, 예를 들어 __트리 구조 탐색__ 같은 상황은 일반적인 애플리케이션 프로그래밍, 특히 DB의존적인 애플리케이션의 개발에는 접할 일이 별로 없습니다.

그런데 이런 형태의 반복적 상황은 선형 반복으로는 해결할 수 없습니다.(해결하기 어렵습니다.)

반복문과 함께 분기 지점의 상태를 임시로 보관할 스택 같은 자료구조가 별도로 동원되어야 하는데요. __재귀 호출을 사용하는 방식과 스택에 할일을 보관하면서 분기를 직접 처리하는 방식은 사실상 동일__ 합니다.

__시스템의 호출 스택을 사용(재귀)__ 할 것이냐 __별도의 명시적인 스택__ 을 사용하느냐의 차이 뿐입니다.

선형 반복에도 주로 재귀를 사용하는 __함수형 프로그래밍 언어__ 에서는 이미 재귀에 익숙하기 때문에 __분기를 처리해야 하는 문제도 큰 어려움 없이 재귀로 해결__ 합니다.

하지만 __반복문으로 선형 반복을 처리하던 자바 개발자는 분기 상황에서 갑자기 처리 방법을 재귀로 바꾸거나 스택을 도입해야 하기 때문에 난이도가 갑자기 올라가는 것으로 느낄 것입니다.__

그나마 스택을 사용한 번거로운 방법을 조금 더 쉽다고 느끼는 것 같습니다.

좀처 처럼 경험하기 힘들고 복잡한 문제를 해결하는 기술이기 때문에 낯설 뿐 아니라 더 어렵다고 주장할 수 있습니다.

만약 이것이 범인이었다면 전 보다 똑똑한 사람이어야 합니다. 그런데 그다지 똑똑하지 않다고 이미 말씀드렸으므로 성급하게 범인으로 지목하지 않겠습니다.

다만 자바 개발자 입장에서 컬렉션 프레임워크가 반복문으로 처리하기 좋게 만들어져 있기 때문에 함수형 프로그래밍 언어를 사용하는 사람들과 달리 재귀를 경험할 기회가 별로 없고, 재귀로 풀면 좋은 문제 상황을 드물게 만나면 갑자기 사고하는 방식을 바꿔야 하기 때문에 어렵다고 느낄 수는 있습니다.

#### 셋 쨰 용의자 : 제어 흐름 추적 습관.

__자바는 명령형 프로그래밍 언어__ 입니다.

객체 지향 언어를 표방하지만 그 기저에는 __명령형 패러다임__ 이 깔려있습니다.

따라서 우리는 자바로 프로그래밍을 할 때 컴퓨터에게 명령을 내린다고 생각하면서 __그 명령의 순서와 분기와 반복을 추적하는 습관을 무의식중에 훈련__ 합니다.

예를 들어 팩토리얼을 구하는 코드를 작성해 보겠습니다.

팩토리얼은 특정 숫자 n이 주어졌을 때 [1, n] 까지의 자연수를 모두 곱한 수 이고 n!이라고 표기합니다.

1부터 n까지의 숫자를 모두 곱한 값이므로 이를 코드로 바꾸면 다음과 같이 반복문을 사용해서 계산할 수 있습니다.

<script src="https://gist.github.com/BongHoLee/7d3e71daa4136989a01674700f897968.js"></script>

이 코드를 작성하고 읽을 때 우리는 한 줄 한 줄 __컴퓨터가 실행하는 과정을 단계별로 추적__ 합니다.

결국 우리는 __컴퓨터에게 어떻게 팩토리얼을 계산하는지 알려준다는 느낌으로 코드를 작성__ 합니다.

팩토리얼을 위와 다른 형태의 식으로 정의할 수 있습니다.

1. if(n == 0) ->  n! == 1
2. if(n > 0)  -> (n-1)! * n  

n이 0일 때는 1이고 0보다 클 때는 (n-1)!와 n의 곱이라는 의미입니다.

이를 코드로 표현하면 다음과 같습니다.

<script src="https://gist.github.com/BongHoLee/130aebb3f68324cf619e8932c6ca2687.js"></script>

보시는 것 처럼 __위 식을 그대로 코드에 담았습니다.__ 이 코드는 __어떻게 문제를 풀어야 하는지 명령을 내린다는 느낌 보다는 문제 저으이 자체를 그대로 코드료 표현한다는 느낌이 강합니다.__

핵심은 이렇습니다. 우리가 프로그래밍을 하는 방법은 크게 두 가지입니다.

보통은 __우리가 컴퓨터에게 명령을 내려서 문제를 풀게 제어한다는 생각으로 프로그래밍 하도록 훈련받았습니다.__ 그런데 고수준 언어에서는 __이렇게 명령을 내리는 방식 말고 문제 정의를 코드로 표현한다는 느낌으로 코딩하는 방식도 있습니다.__

이런 방식을 __선언적 프로그래밍__ 이라고 합니다.

#### 결론

저는 확신하는데 재귀를 어렵게 느끼는 이유는 머리가 나빠서도 아니고 좀 처럼 경험하기 힘든 특수한 상황에서만 필요한 고급 기법이기 때문도 아닙니다.

프로그램을 작성하면서 __머리를 굴리는 방식이 다르기 때문__ 입니다.

즉, __어려운게 아니고 다른겁니다.__ 다시말해 __어색한 것이지 난해한 게 아닙니다.__

재귀 문제 몇 번만 풀어보면 금방 감을 잡을 수 있습니다.

물론 명령형으로도 어려운 알고리즘을 만들려면 어려운 것처럼 재귀로도 어려운 알고리즘은 어렵습니다.

하지만 재귀가 어려운것은 아닙니다.

__재귀 코드를 보면 절대 흐름을 추적하려 하지 마십시오. 오히려 문제를 정의한 식으로 보십시오. 그리고 어떤 식으로 처리될 지 머리에서 CPU를 모의 실험하지 마시고 그 정의가 무엇을 나타내는 정의인지 이해하려고 하십시오.__



### 참고 및 출처
https://blog.fupfin.com/?p=150
